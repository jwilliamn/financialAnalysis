listFiles <- list.files("data", full.names = TRUE)
for(i in 1:80){
name <- listFiles[i]
tmp <- read.csv(listFiles[i])
tmp <- as.data.frame(t(tmp))
tmp <- tmp[-1, ]
write.table(tmp, file = name, sep = ",")
}
check <- data.frame()
for(i in 1:80){
tmp<- read.csv(listFiles[i])
check <- rbind(check, c(i, dim(tmp)[1], dim(tmp)[2]))
}
check$X176L <- factor(check$X176L)
f127 <- check[check$X176L == 127,]
f176 <- check[check$X176L == 176,]
f262 <- check[check$X176L == 262,]
substrRight <- function(x, n){
substr(x, nchar(x)-n+1, nchar(x))
}
for(j in 1:dim(f127)[1]){
arranged <- data.frame()
name <- listFiles[f127[j,1]]
tmp <- read.csv(listFiles[f127[j,1]])
# getting the year
syear <- substrRight(row.names(tmp)[1], 4)
nyear <- as.numeric(syear)
year <- c()
for(i in 1:length(row.names(tmp))){
year <- c(year, nyear-1+i)
}
# changing "-" to "0"
f <- sapply(tmp, is.factor)
for(c in 1:dim(tmp)[2]){
if(f[c] == T){
levels(tmp[, c])[levels(tmp[, c]) == "-"] <- "0"
}
}
arranged <- cbind.data.frame(year, tmp$V2, tmp$V3, tmp$V4, tmp$V12, tmp$V1, tmp$V20,
tmp$V27, tmp$V28, tmp$V38, tmp$V39, tmp$V41, tmp$V42,
tmp$V43, tmp$V44, tmp$V51, tmp$V54, tmp$V61, tmp$V80,
tmp$V1, tmp$V94, tmp$V107, tmp$V110, tmp$V112, tmp$V117)
colnames(arranged) <- c("year", "V2", "V3", "V5", "V7", "V10", "V19", "V26",
"V27", "V34", "V35", "V38", "V39", "V40", "V37", "V47",
"Cpp", "V57", "V71", "V72", "V73",
"V79", "V85", "V86", "V91")
# converting factors as numeric
ff <- sapply(arranged, is.factor)
for(cc in 1:dim(arranged)[2]){
if(ff[cc] == T){
arranged[, cc] <- as.numeric(levels(arranged[, cc]))[arranged[, cc]]}
}
write.table(arranged, file = name, sep = ",", quote = F)
}
str(arranged)
str(tmp)
tail(tmp)
View(arranged)
